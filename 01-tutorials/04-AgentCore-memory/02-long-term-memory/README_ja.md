# AgentCore Memory：長期記憶戦略

## 概要

Amazon Bedrock AgentCoreの長期記憶は、AIエージェントが複数の会話とセッションにわたって永続的な情報を維持できるようにします。即座のコンテキストに焦点を当てる短期記憶とは異なり、長期記憶は意味のある情報を抽出、処理、保存し、将来のインタラクションで取得・適用できるようにして、真にパーソナライズされた知的なエージェント体験を創出します。

## 長期記憶とは何か？

長期記憶の提供機能：

- **セッション間の永続性**：個別の会話を超えて存続する情報
- **知的抽出**：重要な事実、好み、パターンの自動識別と保存
- **意味理解**：自然言語検索を可能にするベクターベースの保存
- **パーソナライゼーション**：カスタマイズされた体験を可能にするユーザー固有の情報
- **知識蓄積**：時間をかけた継続的な学習と情報構築

## 長期記憶戦略の仕組み

長期記憶は、どの情報を抽出し、どのように処理するかを定義する**記憶戦略**を通じて動作します。システムはバックグラウンドで自動的に動作します：

### 処理パイプライン

1. **会話分析**：保存された会話が設定された戦略に基づいて分析される
2. **情報抽出**：重要なデータ（事実、好み、要約）がAIモデルを使用して抽出される
3. **構造化保存**：抽出された情報が効率的な取得のためにネームスペースで整理される
4. **意味インデックス**：自然言語検索機能のために情報がベクター化される
5. **統合**：類似の情報が時間をかけて統合・改良される

**処理時間**：通常、会話が保存された後約1分で、追加のコードは必要ありません。

### 舞台裏

- **AI駆動抽出**：基盤モデルを使用して関連情報を理解・抽出する
- **ベクター埋め込み**：類似性ベースの検索のための意味表現を作成する
- **ネームスペース組織**：設定可能なパス様階層を使用して情報を構造化する
- **自動統合**：重複を防ぐために類似情報を統合・改良する
- **段階的学習**：会話パターンに基づいて抽出品質を継続的に改善する

## 長期記憶戦略タイプ

AgentCore Memoryは、長期情報保存のための4つの異なる戦略タイプをサポートします：

### 1. セマンティック記憶戦略

類似性検索のためにベクター埋め込みを使用して、会話から抽出された事実情報を保存します。

```python
{
    "semanticMemoryStrategy": {
        "name": "FactExtractor",
        "description": "事実情報を抽出・保存する",
        "namespaces": ["support/user/{actorId}/facts"]
    }
}
```

**最適な用途**：製品情報、技術詳細、または自然言語クエリを通じて取得する必要がある事実データの保存。

### 2. 要約記憶戦略

長いインタラクションのコンテキストを保持するために会話の要約を作成・維持します。

```python
{
    "summaryMemoryStrategy": {
        "name": "ConversationSummary",
        "description": "会話要約を維持する",
        "namespaces": ["support/summaries/{sessionId}"]
    }
}
```

**最適な用途**：フォローアップ会話でのコンテキスト提供と長いインタラクションでの継続性維持。

### 3. ユーザー好み記憶戦略

インタラクションをパーソナライズするためにユーザー固有の好みと設定を追跡します。

```python
{
    "userPreferenceMemoryStrategy": {
        "name": "UserPreferences",
        "description": "ユーザーの好みと設定を捕捉する",
        "namespaces": ["support/user/{actorId}/preferences"]
    }
}
```

**最適な用途**：コミュニケーション好み、製品好み、またはその他のユーザー固有設定の保存。

### 4. カスタム記憶戦略

抽出と統合のプロンプトのカスタマイズを可能にし、特殊なユースケースに柔軟性を提供します。

```python
{
    "customMemoryStrategy": {
        "name": "CustomExtractor",
        "description": "カスタム記憶抽出ロジック",
        "namespaces": ["user/custom/{actorId}"],
        "configuration": {
            "semanticOverride": { # SummaryやUser Preferencesをオーバーライドすることも可能
                "extraction": {
                    "appendToPrompt": "カスタム基準に基づいて特定の情報を抽出",
                    "modelId": "anthropic.claude-3-sonnet-20240229-v1:0",
                },
                "consolidation": {
                    "appendToPrompt": "抽出された情報を特定の形式で統合",
                    "modelId": "anthropic.claude-3-sonnet-20240229-v1:0",
                }
            }
        }
    }
}
```

**最適な用途**：標準戦略に適合しない特殊な抽出ニーズ。

## ネームスペースの理解

ネームスペースは、パス様構造を使用して戦略内の記憶レコードを整理します。動的に置換される変数を含めることができます：

- `support/facts/{sessionId}`：セッション別に事実を整理
- `user/{actorId}/preferences`：アクターID別にユーザー好みを保存
- `meetings/{memoryId}/summaries/{sessionId}`：記憶別に要約をグループ化

`{actorId}`、`{sessionId}`、`{memoryId}`変数は、記憶の保存と取得時に実際の値で自動的に置換されます。

## 例：実際の動作

ユーザーがカスタマーサポートエージェントに次のように伝えたとします：_「私はベジタリアンで、イタリア料理がとても好きです。午後6時以降は電話しないでください。」_

この会話を保存した後、設定された戦略が自動的に：

**セマンティック戦略**が抽出：

- 「ユーザーはベジタリアン」
- 「ユーザーはイタリア料理を楽しんでいる」

**ユーザー好み戦略**が捕捉：

- 「食事の好み：ベジタリアン」
- 「料理の好み：イタリアン」
- 「連絡の好み：午後6時以降の電話禁止」

**要約戦略**が作成：

- 「ユーザーが食事制限と連絡設定について話し合った」

これらすべてがバックグラウンドで自動的に発生します - 会話を保存するだけで、戦略が残りを処理します。

## 利用可能なサンプルノートブック

長期記憶戦略の実装を学ぶための実践的な例を探索してください：

| 統合方法 | ユースケース | 説明 | ノートブック | アーキテクチャ |
| ------------------------- | ------------------- | --------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------ |
| Strands Agent Hooks | カスタマーサポート | セマンティックおよび好み記憶戦略を備えた完全なサポートシステム | [customer-support.ipynb](./01-single-agent/using-strands-agent-hooks/customer-support/customer-support.ipynb) | [表示](./01-single-agent/using-strands-agent-hooks/customer-support/architecture.png) |
| Strands Agent Hooks | 数学アシスタント | ユーザーの学習好みと進捗を記憶する数学家庭教師アシスタント | [math-assistant.ipynb](./01-single-agent/using-strands-agent-hooks/simple-math-assistant/math-assistant.ipynb) | [表示](./01-single-agent/using-strands-agent-hooks/simple-math-assistant/architecture.png) |
| Strands Agent Memory Tool | 料理アシスタント | 食事の好みと料理スタイルを学習する食品推薦エージェント | [culinary-assistant.ipynb](./01-single-agent/using-strands-agent-memory-tool/culinary-assistant.ipynb) | [表示](./01-single-agent/using-strands-agent-memory-tool/architecture.png) |
| マルチエージェント | エージェント協調 | 長期記憶戦略を共有・活用する複数エージェントを持つ旅行アシスタント | [travel-booking-assistant.ipynb](./02-multi-agent/with-strands-agent/travel-booking-assistant.ipynb) | [表示](./02-multi-agent/with-strands-agent/architecture.png) |

## 使い始める

1. あなたのユースケースに合うサンプルを選択する
2. サンプルフォルダに移動する
3. 要件をインストールする：`pip install -r requirements.txt`
4. Jupyterノートブックを開き、ステップバイステップの実装に従う

## ベストプラクティス

1. **戦略選択**：ユースケース要件に基づいて適切な戦略を選択する
2. **ネームスペース設計**：効率的な情報組織のためにネームスペース階層を計画する
3. **抽出調整**：ドメイン固有情報のために抽出プロンプトをカスタマイズする
4. **パフォーマンス監視**：記憶抽出品質と検索パフォーマンスを追跡する
5. **プライバシー考慮事項**：適切なデータ保持とプライバシーポリシーを実装する

## 次のステップ

長期記憶戦略を習得した後、以下を探索してください：

- 包括的なエージェント体験のための短期記憶と長期記憶の組み合わせ
- 高度なカスタム戦略設定
- マルチエージェント記憶共有パターン
- 本番環境展開の考慮事項